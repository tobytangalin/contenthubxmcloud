<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="Audience - do not use" content=""></meta><meta name="clubot" content=""></meta><meta name="data model" content=""></meta><meta name="DxP type - Do Not Use" content=""></meta><meta name="media_icon" content=""></meta><meta name="product" content="XM Cloud"></meta><meta name="Publishing target" content="Production"></meta><meta name="Ready for publishing - do not use" content=""></meta><meta name="role" content="developers"></meta><meta name="topic_tripane" content=""></meta><meta name="version" content=""></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			window.versionsfile = '';


			window.indexDict = new Array();
			window.store = {};
			window.portalLanguage = 'en';
			window.enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				var instantsearch_minlength = 1;
						
			var useanchorlinks = false;
			
					function addSearch(){
					//not used with custom or elastic search
					}
				</script><title>Dependency injection</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css?version=20230630"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css?version=20230630"></link><link rel="stylesheet" type="text/css" href="../css/content-theme1.css?version=20230630"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="/css/sitecore-custom-default-xmc.css?version=20230630"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js?version=20230630" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js?version=20230630" type="text/javascript"></script><script src="../js/html5-2.js?version=20230630" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="/js/layout-custom-script.js" type="text/javascript"></script><meta xmlns:xhtml="http://www.w3.org/1999/xhtml" name="generator" content="Paligo"></meta><meta name="description" content="Describes how Sitecore supports dependency injection"></meta><meta name="keywords" content="Development"></meta><link rel="prev" href="dynamic-placeholders.html#idm45599237650320" title="Known limitations"></link><link rel="next" href="dependency-injection.html#idm45599237561056" title="Service registration"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.1/js.cookie.min.js"></script><script type="text/javascript">var privacypolicy = 'https://www.sitecore.com/trust/privacy-policy';
var consenttype = 'opt-out';
</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-72664331-1"></script><script type="text/javascript">const measurementId = 'UA-72664331-1';

						$(document).on('cookies.consented', () => {
							window.dataLayer = window.dataLayer || [];
							function gtag(){dataLayer.push(arguments)};

							gtag('js', new Date());
							gtag('config', measurementId);
						});
					</script><script type="text/javascript" src="../js/cookie-consent.js"></script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/googlecode.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script><script type="text/javascript">
			$(document).ready(function() {

				$('pre:not(.embedcode)').each(function() {
					/**
					 * @type {string}
					 */
					var language = $(this).data('language');

					if (language === 'plaintext' || language === 'text') {
						$(this).addClass(language).addClass('hljs');
						return true;
					}
					else {
						var clone = this.cloneNode(true);
						hljs.highlightBlock(clone);
						$(this).empty().append($(clone).contents());
						$(this).attr("class", $(clone).attr("class"));
					}
				});
			});
			</script><link href="//customer.cludo.com/assets/2063/10039/cludo-search.min.css" type="text/css" rel="stylesheet"></link></head><body class="theme1 colored-top page-toc current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><style type="text/css">
            div.skipnav {
            }
            div.skipnav a {
                position: fixed;
                left: -10000px;
                top: 1.5em;
                width: 1px;
                height: 1px;
                overflow: hidden;
            }
            div.skipnav a:focus, div.skipnav a:active, div.skipnav a:hover {
                background: white;
                color: black;
                box-shadow: 5px 5px 5px 0px rgba(0,0,0,0.5);
                position: fixed;
                left: 2em;
                top: 1.5em;
                width: auto;
                height: auto;
                overflow: visible;
                text-decoration: underline;
                z-index: 99999; /* has to be higher than the side panel */
    }
          </style><div class="skipnav"><a href="#content-wrapper">Skip to main content</a></div><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="https://doc.sitecore.com/xmc/" target="_blank" rel="noopener"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div class="navbar-collapse collapse" id="navbar"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside xmlns:xinfo="http://ns.expertinfo.se/cms/xmlns/1.0" class="site-sidebar"><div class="site-sidebar-header"><a href="https://doc.sitecore.com/xmc/" target="_blank"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form id="search-form" class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print"><i class="fa fa-print" aria-hidden="true">print</i></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"><a href="index-en.html">XM Cloud Documentation for Developers</a></li><li class="breadcrumb-link"><a href="xm-cloud-development.html">XM Cloud development</a></li><li class="breadcrumb-link"><a href="miscellaneous-development-tasks.html">Miscellaneous development tasks</a></li><li class="breadcrumb-node">Dependency injection</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" class="prev pull-left prev visible-lg visible-md" id="header-navigation-prev" href="dynamic-placeholders.html#idm45599237650320">Prev</a></li><li class="next"><a accesskey="n" class="pull-right next visible-lg visible-md" id="header-navigation-next" href="dependency-injection.html#idm45599237561056">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section original-topic" data-origin-id="UUID-6add1018-320f-bb34-6a79-ed126f28c214" data-permalink="dependency-injection.html" data-topic-level="1" data-relative-prefix="" data-time-modified="03/09/2021" data-publication-date="06/30/23" id="UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a"><div class="titlepage"><div><div class="title"><h1 class="title" style="clear: both">Dependency injection</h1></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Describes how Sitecore supports dependency injection</p></div></div></div></div><p>Dependency injection (DI) is a technique for achieving loose coupling between objects and their collaborators, or dependencies. Rather than directly instantiating collaborators, or using static references, the objects a class needs in order to perform its actions are provided to the class in some fashion. Most often, classes will declare their dependencies through their constructor. Sitecore only supports this approach, which is known as constructor injection.</p><p>The Sitecore implementation of DI is based on the <a class="link" href="https://github.com/aspnet/DependencyInjection" target="_blank" rel="noopener">Microsoft.Extensions.DependencyInjection</a> abstractions from ASP.NET Core.</p><section dir="ltr" class="section internal accordion" data-origin-id="" data-publication-date="06/30/23" id="idm45599237561056"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#idm45599237561056_body" data-parent="#idm45599237561056"><div><div class="title"><h2 class="title" style="clear: both">Service registration</h2></div></div></a></div></div><div class="panel-body collapse" id="idm45599237561056_body"><p>You can register the abstraction either in configuration or with code.</p><section dir="ltr" class="section internal" data-origin-id="" data-publication-date="06/30/23" id="idm45599237556048"><div class="titlepage"><div><div class="title"><h3 class="title">Registration in configuration</h3></div></div></div><p>You can configure abstraction in the <span class="italic">services</span> node in any Sitecore include config file. For example:</p><pre class="programlisting">&lt;configuration&gt;
    &lt;sitecore&gt;
        &lt;services&gt;
            &lt;register serviceType="IMyService, MyAbstraction.Assembly" implementationType="MyServiceImplementation, MyImplementation.Assembly" /&gt;
            &lt;register serviceType="MyServiceBase, MyAbstraction.Assembly" implementationType="MyServiceBaseImplementation, MyImplementation.Assembly" /&gt;
        &lt;/services&gt;
    &lt;/sitecore&gt;
&lt;/configuration&gt;
</pre></section><section dir="ltr" class="section internal" data-origin-id="" data-publication-date="06/30/23" id="idm45599237555472"><div class="titlepage"><div><div class="title"><h3 class="title">Registration in code</h3></div></div></div><p>You use the <code class="code">IServicesConfigurator</code> interface to configure services from code. For example:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Implement the <code class="code">IServicesConfigurator</code> interface:</p><pre class="programlisting">public class MyServicesConfigurator : IServicesConfigurator    
    {
        public void Configure(IServiceCollection serviceCollection)
        {
            serviceCollection.AddScoped(typeof(IMyService), typeof(MyServiceImplementation));
            serviceCollection.AddTransient(typeof(MyServiceBase), typeof(MyServiceBaseImplementation));
        }
} 
</pre><p>There is more information about <span class="italic">IServiceServiceCollection</span> on the <a class="link" href="https://docs.asp.net/en/latest/fundamentals/dependency-injection.html" target="_blank" rel="noopener"> MSDN website</a>.</p></li><li class="listitem"><p>Register the configurator:</p><pre class="programlisting">&lt;configuration&gt;
    &lt;sitecore&gt;
        &lt;services&gt;
            &lt;configurator type= "MyServicesConfigurator, MyAssembly"/&gt;
        &lt;/services&gt;
    &lt;/sitecore&gt;
&lt;/configuration&gt;
</pre></li></ul></div></section></div></div></section><section dir="ltr" class="section internal accordion" data-origin-id="" data-publication-date="06/30/23" id="idm45599237558624"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#idm45599237558624_body" data-parent="#idm45599237558624"><div><div class="title"><h2 class="title" style="clear: both">Services lifetime</h2></div></div></a></div></div><div class="panel-body collapse" id="idm45599237558624_body"><p>Read important information about <a class="link" href="https://docs.asp.net/en/latest/fundamentals/dependency-injection.html" target="_blank" rel="noopener"> Service Lifetimes and Registration Options</a> on the MSDN website.</p><p>To support scoped per request lifetime, <code class="code">Sitecore.DependencyInjection.SitecorePerRequestScopeModule, Sitecore.Kernel</code> was added to the http modules. If the module is disabled, <span class="italic">Scoped</span> has the same behavior as <span class="italic">Singleton</span>.</p></div></div></section><section dir="ltr" class="section internal accordion" data-origin-id="" data-publication-date="06/30/23" id="UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_injection-to-types-created-by-factory-pr"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_injection-to-types-created-by-factory-pr_body" data-parent="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_injection-to-types-created-by-factory-pr"><div><div class="title"><h2 class="title" style="clear: both">Service resolution</h2></div></div></a></div></div><div class="panel-body collapse" id="UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_injection-to-types-created-by-factory-pr_body"><p>This section describes how you resolve (locate) a registered service through DI, using a service locator.</p><section dir="ltr" class="section internal" data-origin-id="" data-publication-date="06/30/23" id="idm45599237541072"><div class="titlepage"><div><div class="title"><h3 class="title">Injection to types created by Factory</h3></div></div></div><p>You must use the <code class="code">resolve</code> attribute. The following changes enable injection for the <span class="italic">ShowReason</span> processor of the <code class="code">shutdown</code> pipeline:</p><pre class="programlisting">&lt;shutdown&gt;
     &lt;processor type="Sitecore.Pipelines.Shutdown.ShowReason, Sitecore.Kernel" resolve="true"/&gt; &lt;/shutdown&gt;
</pre></section><section dir="ltr" class="section internal" data-origin-id="" data-publication-date="06/30/23" id="UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_injection-to-webforms"><div class="titlepage"><div><div class="title"><h3 class="title">Injection and MVC</h3></div></div></div><p>By default, Sitecore MVC uses the Sitecore implementation of dependency injection. Configure controllers and their dependencies as described in the current topic, and remember to register both.</p></section><section dir="ltr" class="section internal" data-origin-id="" data-publication-date="06/30/23" id="idm45599237535424"><div class="titlepage"><div><div class="title"><h3 class="title">Injection to WebForms and UserControls</h3></div></div></div><p>Use the <code class="code">[Sitecore.DependencyInjection.AllowDependencyInjection]</code> attribute for Forms and UserControls:</p><pre class="programlisting">[Sitecore.DependencyInjection.AllowDependencyInjection] 
public partial class Default : System.Web.UI.Page 
{
    protected Default() // important 
    { 
    }
    public Default(IMyService myService, MyServiceBase serviceBase) 
    { 
        … 
    } 
} 
</pre><p>The Form must also have a default constructor (this is a limitation of ASP.NET).</p></section><section dir="ltr" class="section internal" data-origin-id="" data-publication-date="06/30/23" id="idm45599237534192"><div class="titlepage"><div><div class="title"><h3 class="title">Service locator</h3></div></div></div><p>It is currently not possible to use dependency injection with all parts of Sitecore, so sometimes the service locator is the only solution. This is, for example, the case in page handler factories, MVC controller factories, and in static manager for backward compatibility.</p><p>Therefore, you can use the <code class="code">Sitecore.DependencyInjection.ServiceLocator</code> class. For example:</p><pre class="programlisting">var service = ServiceLocator.ServiceProvider.GetService(typeof(IMyService))
</pre><p>Or, for example:</p><pre class="programlisting">var service = ServiceLocator.ServiceProvider.GetService&lt;MyServiceBase&gt;();
</pre></section></div></div></section><section dir="ltr" class="section internal accordion" data-origin-id="" data-publication-date="06/30/23" id="UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_registration-with-configuration"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_registration-with-configuration_body" data-parent="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_registration-with-configuration"><div><div class="title"><h2 class="title" style="clear: both">View the dependency injection configuration</h2></div></div></a></div></div><div class="panel-body collapse" id="UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_registration-with-configuration_body"><p>You can see the details of the dependency injection at this URL: <span class="underline">http://[instance]/sitecore/admin/showservicesconfig.aspx</span>.</p><p>You can see configured-in services (node services) at this URL: <span class="underline">http://[instance]/sitecore/admin/showconfig.aspx</span>.</p></div></div></section><section dir="ltr" class="section internal accordion" data-origin-id="" data-publication-date="06/30/23" id="UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_replace-service-provider"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_replace-service-provider_body" data-parent="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_replace-service-provider"><div><div class="title"><h2 class="title" style="clear: both">Replace service provider</h2></div></div></a></div></div><div class="panel-body collapse" id="UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_replace-service-provider_body"><p>You can replace the service provider. Sitecore uses the Microsoft.Extensions.DependencyInjection package default.</p><p>To replace default provider:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Inherit from <code class="code">Sitecore.DependencyInjection.BaseServiceProviderBuilder</code> and implement the <code class="code">BuildServiceProvider</code> method:</p><pre class="programlisting">public class MyProviderBuilder : BaseServiceProviderBuilder
{
    protected override IServiceProvider BuildServiceProvider(IServiceCollection serviceCollection)
    {
        return MyFavouriteServiceProvider.Build(serviceCollection);
    }
} 
</pre><p>The <a class="link" href="https://github.com/aspnet/DependencyInjection" target="_blank" rel="noopener">Framework site</a> has a list of the containers that Sitecore supports.</p></li><li class="listitem"><p>Replace the default builder in <code class="code">Sitecore.config</code> with your builder:</p><pre class="programlisting">&lt;serviceProviderBuilder type="Sitecore.DependencyInjection.DefaultServiceProviderBuilder,    Sitecore.Kernel"/&gt; 
</pre><p>You can also patch this node with an <a class="link" href="http://sitecore-community.github.io/docs/documentation/Sitecore%20Fundamentals/Patch%20Files/" target="_blank" rel="noopener"> include file</a><span class="underline">:</span></p><pre class="programlisting">&lt;serviceProviderBuilder type="MyProviderBuilder"/&gt;
</pre></li></ul></div></div></div></section></section><div class="footer-content"><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a">Dependency injection</a></li><li><a href="#idm45599237561056">Service registration</a></li><li><a href="#idm45599237558624">Services lifetime</a></li><li><a href="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_injection-to-types-created-by-factory-pr">Service resolution</a></li><li><a href="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_registration-with-configuration">View the dependency injection configuration</a></li><li><a href="#UUID-f06900cd-dc4c-6453-c555-f8a43c8fa66a_id_replace-service-provider">Replace service provider</a></li></ul></aside></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" class="prev pull-left prev visible-lg visible-md" id="header-navigation-prev" href="dynamic-placeholders.html#idm45599237650320">Prev</a></li><li class="next"><a accesskey="n" class="pull-right next visible-lg visible-md" id="header-navigation-next" href="dependency-injection.html#idm45599237561056">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2023 Sitecore </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">03/09/2021</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date">06/30/23</span></div></div></footer></div></div></div></div><script type="text/javascript" src="//customer.cludo.com/scripts/bundles/search-script.min.js"></script><script>
			var CludoSearch;
			(function () {
			var cludoSettings = {
			customerId: 2063,
			engineId: 12826,
			language: 'en',
			searchInputs: ["search-form","cludo-search-content-form","cludo-search-mobile-form"],
			hideSearchFilters: true,
			type: 'standardOverlay',
			facets: ["Category", "ProductVer", "Product", "Version"],
			useStandardSearchTemplate: false,
			customerTemplate: "OverlayCopy",
			searchApiUrl: 'https://api-eu1.cludo.com/api/v3'
			};
			CludoSearch= new Cludo(cludoSettings);
			CludoSearch.init();
			})();
		</script><!-- www.Cludo.com Search body init script start --></body></html>
